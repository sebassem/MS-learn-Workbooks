{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Azure Monitor Workbook\r\n## Microsoft Learn Module\r\nThis is a test workbook"
      },
      "name": "text - 0"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "7bb178af-7e8c-40b5-9e8c-914569b6f0af",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "value": "/subscriptions/ebb79bc0-aa86-44a7-8111-cabbe0c43993",
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "50",
      "name": "parameters - 1"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "749c73c0-2bb7-406a-884f-da8a888a3ced",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "overview",
            "style": "link"
          },
          {
            "id": "0e541ed1-0f93-413f-8b1b-0586bf036af2",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Compute",
            "subTarget": "compute",
            "style": "link"
          },
          {
            "id": "e0bf8338-b6c1-417a-ad55-833a3855ba42",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Applications",
            "subTarget": "applications",
            "style": "link"
          },
          {
            "id": "c22ea5b5-e7ac-460f-8638-77f31a062535",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Networking",
            "subTarget": "networking",
            "style": "link"
          },
          {
            "id": "8bb62100-f083-4ab8-9367-7435b17ce55a",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Monitoring",
            "subTarget": "monitoring",
            "style": "link"
          },
          {
            "id": "e7a327ed-1aa5-45e4-96aa-054fddec6c2f",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Security",
            "subTarget": "security",
            "style": "link"
          },
          {
            "id": "5a75bc2c-12b0-4e3f-a0f7-4bfe3f0e57cf",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Governance",
            "subTarget": "governance",
            "style": "link"
          }
        ]
      },
      "name": "links - 2"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "summarize count() by location",
              "size": 0,
              "title": "Resources distribution per region",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "map",
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "location",
                "sizeSettings": "count_",
                "sizeAggregation": "Sum",
                "labelSettings": "location",
                "legendMetric": "count_",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "count_",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "name": "query - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources |  parse type with * \"/\" resourceType\r\n| project resourceType\r\n| summarize count() by resourceType",
              "size": 0,
              "title": "Resource types",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "resourceType",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              }
            },
            "name": "query - 1"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "group - Overview",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "351363ec-79b6-4b46-82ca-9593dfc52292",
                  "version": "KqlParameterItem/1.0",
                  "name": "VirtualMachines",
                  "label": "Virtual Machines",
                  "type": 5,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources | where type == \"microsoft.compute/virtualmachines\" | project id",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 0"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook2160defd-7002-4b1d-a347-872a76fc0ac9",
              "version": "MetricsItem/2.0",
              "size": 2,
              "chartType": -3,
              "resourceType": "microsoft.compute/virtualmachines",
              "metricScope": 0,
              "resourceParameter": "VirtualMachines",
              "resourceIds": [
                "{VirtualMachines}"
              ],
              "timeContext": {
                "durationMs": 3600000
              },
              "metrics": [
                {
                  "namespace": "microsoft.compute/virtualmachines",
                  "metric": "microsoft.compute/virtualmachines--Percentage CPU",
                  "aggregation": 4
                }
              ],
              "title": "Virtual machines CPU performance",
              "graphSettings": {
                "type": 2,
                "topContent": {
                  "columnMatch": "Name",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": "Resource",
                    "linkIsContextBlade": true,
                    "showIcon": false
                  }
                },
                "centerContent": {
                  "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 1
                    }
                  }
                },
                "hivesContent": {
                  "columnMatch": "Subscription",
                  "formatter": 15,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "nodeIdField": "Name",
                "graphOrientation": 3,
                "showOrientationToggles": false,
                "nodeSize": null,
                "staticNodeSize": 100,
                "colorSettings": {
                  "nodeColorField": "microsoft.compute/virtualmachines--Percentage CPU",
                  "type": 4,
                  "heatmapPalette": "greenRed",
                  "heatmapMin": 30,
                  "heatmapMax": 80,
                  "emptyValueColor": "gray"
                },
                "groupByField": "Subscription",
                "hivesMargin": 5
              },
              "gridSettings": {
                "rowLimit": 10000
              }
            },
            "name": "metric - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.Compute/skus?$filter=location eq 'westus'\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-04-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.*[?(@.resourceType=='virtualMachines')]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\"},{\"path\":\"capabilities[?(@.name=='vCPUs')].value\",\"columnid\":\"vCPUs\"},{\"path\":\"id\",\"columnid\":\"ID\"}]}}]}",
              "size": 0,
              "title": "Virtual Machines vCPUs",
              "queryType": 12
            },
            "conditionalVisibility": {
              "parameterName": "isVisible",
              "comparison": "isEqualTo",
              "value": "Never"
            },
            "name": "query - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources \r\n| where type == \"microsoft.compute/virtualmachines\"\r\n| extend SKU=tostring(properties.hardwareProfile.vmSize)\r\n| project id,name,location,resourceGroup,SKU",
              "size": 0,
              "title": "All Virtual machines",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isVisible",
              "comparison": "isEqualTo",
              "value": "Never"
            },
            "name": "query - 3"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d731779a-d3a3-4dd4-8778-d262309b1106\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 2\",\"rightTable\":\"query - 3\",\"leftColumn\":\"Name\",\"rightColumn\":\"SKU\"}],\"projectRename\":[{\"originalName\":\"[query - 3].id\",\"mergedName\":\"id\",\"fromId\":\"d731779a-d3a3-4dd4-8778-d262309b1106\"},{\"originalName\":\"[query - 2].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"d731779a-d3a3-4dd4-8778-d262309b1106\"},{\"originalName\":\"[query - 3].SKU\",\"mergedName\":\"SKU\",\"fromId\":\"d731779a-d3a3-4dd4-8778-d262309b1106\"},{\"originalName\":\"[query - 3].location\",\"mergedName\":\"location\",\"fromId\":\"d731779a-d3a3-4dd4-8778-d262309b1106\"},{\"originalName\":\"[query - 3].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"d731779a-d3a3-4dd4-8778-d262309b1106\"},{\"originalName\":\"[query - 2].ID\"},{\"originalName\":\"[query - 3].name\"},{\"originalName\":\"[query - 2].Name\"}]}",
              "size": 0,
              "title": "Virtual machines SKUs",
              "queryType": 7
            },
            "showPin": false,
            "name": "query - 4"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "compute"
      },
      "name": "group - Compute"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' \r\n    | extend SubscriptionName=name \r\n    | join \t( resources | where type =~ 'Microsoft.Web/sites' \r\n    | extend WebAppId=id, WebAppRG=resourceGroup, WebAppName=name, AppServicePlan=tostring(properties.serverFarmId), SKU=tostring(properties.sku), Type=kind, Status=tostring(properties.state), WebAppLocation=location) on subscriptionId\r\n    | order by WebAppId asc \r\n    | project WebAppId,WebAppName, Type, Status, WebAppLocation, AppServicePlan, WebAppRG,SubscriptionName",
              "size": 0,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isVisible",
              "comparison": "isEqualTo",
              "value": "Never"
            },
            "name": "query - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers), \r\nmaxworkers=tostring(properties.maximumNumberOfWorkers)\r\n| project id,name,skuname,skutier,workers, maxworkers",
              "size": 0,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isVisible",
              "comparison": "isEqualTo",
              "value": "Never"
            },
            "name": "query - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 0\",\"rightTable\":\"query - 1\",\"leftColumn\":\"AppServicePlan\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[query - 0].WebAppId\",\"mergedName\":\"WebAppId\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 0].Type\",\"mergedName\":\"Type\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 0].Status\",\"mergedName\":\"Status\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 0].WebAppLocation\",\"mergedName\":\"WebAppLocation\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 1].skutier\",\"mergedName\":\"skutier\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 0].AppServicePlan\",\"mergedName\":\"AppServicePlan\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 1].skuname\",\"mergedName\":\"skuname\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 0].WebAppRG\",\"mergedName\":\"WebAppRG\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 0].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"fc9bb118-02ce-4e76-a5c0-9183e53640a6\"},{\"originalName\":\"[query - 0].WebAppName\"},{\"originalName\":\"[query - 1].name\"},{\"originalName\":\"[query - 1].id\"},{\"originalName\":\"[query - 1].workers\"},{\"originalName\":\"[query - 1].maxworkers\"}]}",
              "size": 0,
              "title": "Web Apps",
              "exportFieldName": "WebAppId",
              "exportParameterName": "WebAppId",
              "queryType": 7
            },
            "showPin": false,
            "name": "query - 2"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "applications"
      },
      "name": "group - Applications"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "networking"
      },
      "name": "group - Networking"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureHealthQuery/1.0\",\"queryType\":\"Detailed\"}",
              "size": 0,
              "title": "Azure Resource Health",
              "queryType": 4,
              "resourceType": "microsoft.resources/subscriptions",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Availability state",
                    "formatter": 11
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Availability state"
                  ]
                }
              }
            },
            "name": "query - 0"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "monitoring"
      },
      "name": "group - Monitoring"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "security"
      },
      "name": "group - Security"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "governance"
      },
      "name": "group - Governance"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}